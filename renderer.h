#pragma once // 防止头文件重复包含

// 引入场景定义，因为初始化函数需要用到 Object 结构体
#include "scene.h"

// ======================================================================================
// 渲染器接口 (Renderer Interface)
// ======================================================================================
// 这个文件定义了所有 CPU (Host) 可以调用的 GPU 功能。
// 这里的函数在 main.cpp 中被调用，但在 renderer.cu 中实现。
// ======================================================================================

// --------------------------------------------------------------------------------------
// [接口 1] 初始化场景数据
// --------------------------------------------------------------------------------------
// 作用: 将 CPU 端定义的场景数据 (h_objects) 搬运到 GPU 的常量内存中。
// 
// 为什么需要这个函数？
// 因为 GPU 端的全局变量 (比如 __constant__ Object d_objects[]) 
// 对于 main.cpp 来说是"不可见"的，或者链接起来很麻烦。
// 我们通过这个函数封装了 cudaMemcpyToSymbol 操作。
//
// 参数:
//   h_objects: Host(CPU) 端的物体数组指针
//   count:     物体数量
//   texture_files: 纹理文件
// --------------------------------------------------------------------------------------
void init_scene_data(const std::vector<Object>& objects, const std::vector<std::string>& texture_files);

// --------------------------------------------------------------------------------------
// [接口 2] 启动渲染内核 (Kernel Launcher)
// --------------------------------------------------------------------------------------
// 作用: 计算线程块布局，并发射 CUDA 内核。
//
// 为什么需要这个函数？
// CUDA 的内核启动语法 render_kernel<<<blocks, threads>>>(...) 不是标准的 C++。
// 如果我们在 main.cpp 里直接写这行代码，g++ 编译器会报错。
// 所以我们在这里声明一个普通的 C++ 函数，在 renderer.cu (nvcc 编译) 里去写 <<<...>>>。
//
// 参数:
//   accum_buffer: 指向 GPU 显存的指针 (Device Pointer)。
//                 注意：在 CPU 代码里千万不要尝试解引用它 (*accum_buffer)，否则会段错误。
//                 它只是作为一个"句柄"传给 GPU。
//   width, height: 图像分辨率。
//   frame_seed:    当前帧的随机数种子偏移量 (随着帧数增加，让噪点分布变化)。
//   tx, ty:        线程块 (Block) 的大小 (比如 16, 16)。
// --------------------------------------------------------------------------------------
void launch_render_kernel(Vec* accum_buffer, int width, int height, int frame_seed, int tx, int ty, CameraParams cam);
